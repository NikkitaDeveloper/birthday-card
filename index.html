<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HinglishLang IDE â€” One File</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1720; --muted:#99a3b3; --accent:#34d399;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:#e6eef6}
  body{margin:0;background:linear-gradient(180deg,#07111a 0%, #071a21 100%);height:100vh;display:flex;flex-direction:column}
  header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border-bottom:1px solid rgba(255,255,255,0.03)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#06b6d4,#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700}
  .title{font-weight:700;font-size:16px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  select, button, input[type="text"]{background:var(--panel);border:1px solid rgba(255,255,255,0.03);color:inherit;padding:8px;border-radius:8px}
  button{cursor:pointer}
  main{flex:1;display:grid;grid-template-columns:1fr 420px;gap:12px;padding:12px}
  .editorPane{display:flex;flex-direction:column;gap:8px}
  .meta{display:flex;gap:8px;align-items:center}
  textarea#editor{width:100%;height:100%;min-height:400px;background:linear-gradient(180deg,#03121a,#07121c);border-radius:8px;border:1px solid rgba(255,255,255,0.03);padding:12px;color:#dfeffb;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;resize:none;font-size:13px}
  .rightCol{display:flex;flex-direction:column;gap:8px}
  .preview, .console{background:var(--panel);border-radius:8px;padding:8px;min-height:180px;border:1px solid rgba(255,255,255,0.03);overflow:auto}
  .console pre{margin:0;white-space:pre-wrap;font-family:ui-monospace,monospace}
  .tiny{font-size:12px;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
  footer{padding:8px 12px;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,255,255,0.02)}
  .file-actions{display:flex;gap:6px}
  .file-list{max-height:120px;overflow:auto;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.02);background:var(--glass)}
  .btn-ghost{background:transparent;border:1px dashed rgba(255,255,255,0.03);padding:6px;border-radius:6px}
  .hint{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">H</div>
    <div>
      <div class="title">HinglishLang IDE</div>
      <div class="tiny">Hinglish / o1 â€” multi-language playground (one-file)</div>
    </div>
  </div>

  <div class="controls">
    <select id="lang">
      <option value="hinglish">Hinglish â†’ JS (run)</option>
      <option value="javascript">JavaScript (run)</option>
      <option value="html">HTML / CSS (preview)</option>
      <option value="export">Export (C/C++/C#/Python)</option>
    </select>

    <button id="runBtn">Run â–¶</button>
    <button id="stopBtn" disabled>Stop â– </button>

    <div class="file-actions">
      <button id="saveBtn">Save</button>
      <button id="loadBtn">Load</button>
      <button id="downloadBtn">Download</button>
    </div>
  </div>
</header>

<main>
  <section class="editorPane">
    <div class="meta">
      <input id="filename" type="text" placeholder="file name (e.g. app.hpy)" style="width:240px" />
      <div class="hint">Tip: choose Hinglish and press Run</div>
    </div>

    <textarea id="editor" spellcheck="false"></textarea>

    <div class="meta tiny">
      <div>Keys: Save loads to localStorage. Download to export file. Export mode: get code file for other languages.</div>
    </div>
  </section>

  <aside class="rightCol">
    <div class="preview" id="previewWrap">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Preview / Output</strong>
        <span class="tiny" id="status">idle</span>
      </div>
      <iframe id="preview" sandbox="allow-scripts" style="width:100%;height:260px;border:0;margin-top:8px;border-radius:6px;background:#000"></iframe>
    </div>

    <div class="console">
      <strong>Console</strong>
      <pre id="consoleText"></pre>
    </div>

    <div>
      <strong>Saved files</strong>
      <div id="files" class="file-list tiny"></div>
    </div>
  </aside>
</main>

<footer>
  Made with â™¥ â€” HinglishLang prototype. Note: compiled languages need server/toolchains; this app runs JS & Hinglishâ†’JS and previews HTML/CSS in-browser.
</footer>

<script>
/* -------------------------------
   Simple single-file Hinglish IDE
   - Translate Hinglish â†’ JS
   - Run JS or HTML/CSS in sandbox iframe
   - Save / Load via localStorage
   - Download file
   ------------------------------- */

const editor = document.getElementById('editor');
const preview = document.getElementById('preview');
const consoleText = document.getElementById('consoleText');
const runBtn = document.getElementById('runBtn');
const stopBtn = document.getElementById('stopBtn');
const langSel = document.getElementById('lang');
const filesDiv = document.getElementById('files');
const filenameInput = document.getElementById('filename');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const downloadBtn = document.getElementById('downloadBtn');
const status = document.getElementById('status');

let childWindowId = 0; // increment for each run to stop previous
let runningId = null;

/* --- sample content to get started --- */
const SAMPLE = `// Hinglish sample: Number guessing
bolo "Number Guessing Game me swagat hai!"
rakho secret 7
rakho tries 0

jabtak sach toh
    bolo "Apna andaza likho (1-10):"
    rakho guess parseInt(prompt("Apna andaza likho (1-10):"))
    badhao tries 1

    agar guess == secret toh
        bolo "ðŸŽ‰ Sahi jawab!"
        bolo "Aapne", tries, "tries liye."
        break
    warna agar guess < secret toh
        bolo "Bada hai!"
    warna
        bolo "Chhota hai!"
    khatam
khatam
`;
editor.value = SAMPLE;

/* -------------------------
   LocalStorage file helpers
   ------------------------- */
function listFiles() {
  const names = Object.keys(localStorage).filter(k=>k.startsWith('hinglish_file_'));
  filesDiv.innerHTML = names.map(k=>{
    const name = k.replace('hinglish_file_','');
    return `<div style="display:flex;justify-content:space-between;padding:6px 4px">
      <span>${escapeHtml(name)}</span>
      <span>
        <button onclick="loadFile('${name}')" class="btn-ghost">open</button>
        <button onclick="deleteFile('${name}')" class="btn-ghost">del</button>
      </span>
    </div>`;
  }).join('') || '<div class="tiny">(no saved files)</div>';
}
function saveFile() {
  const name = filenameInput.value.trim() || prompt("File name? (eg. app.hpy)");
  if(!name) return alert("Filename required");
  localStorage.setItem('hinglish_file_'+name, editor.value);
  listFiles();
  alert("Saved as " + name);
}
function loadFilePrompt() {
  const names = Object.keys(localStorage).filter(k=>k.startsWith('hinglish_file_')).map(k=>k.replace('hinglish_file_',''));
  if(names.length===0) return alert("No saved files");
  const choice = prompt("Files:\n" + names.join('\n') + "\n\nType filename to open:");
  if(choice && names.includes(choice)) loadFile(choice);
}
function loadFile(name) {
  const val = localStorage.getItem('hinglish_file_'+name);
  if(val===null) return alert("Not found");
  filenameInput.value = name;
  editor.value = val;
}
function deleteFile(name) {
  if(confirm("Delete "+name+"?")) {
    localStorage.removeItem('hinglish_file_'+name);
    listFiles();
  }
}
saveBtn.addEventListener('click', saveFile);
loadBtn.addEventListener('click', loadFilePrompt);
listFiles();

/* -------------------------
   Utilities
   ------------------------- */
function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]);
}

/* -------------------------
   Hinglish â†’ JavaScript translator
   - small, clear subset
   ------------------------- */
function translateHinglishToJS(code) {
  const lines = code.replace(/\r/g,'').split('\n');
  let out = '';
  const declared = new Set();
  // helpers
  function makeAssign(name, rhs){
    if(!declared.has(name)) { declared.add(name); return 'let '+name+' = '+rhs+';'; }
    return name+' = '+rhs+';';
  }
  for(let raw of lines) {
    let line = raw.trim();
    if(line==='') { out += '\\n'; continue; }
    // comments
    if(line.startsWith('//') || line.startsWith('#')) { out += line + '\\n'; continue; }

    // 'banao' function: banao fname(args) toh
    if(line.startsWith('banao ')) {
      let rest = line.slice(6).trim();
      rest = rest.replace(/\btoh\b/g, '').trim();
      if(rest.endsWith(')')) out += 'function ' + rest + ' {' + '\\n';
      else out += 'function ' + rest + ' {' + '\\n';
      continue;
    }

    // 'bolo' -> console.log
    if(line.startsWith('bolo ')) {
      let args = line.slice(5).trim();
      // allow 'bolo "hi", x' directly
      out += 'console.log(' + args + ');\\n';
      continue;
    }

    // rakho var assignment: rakho x 5  -> let x = 5;
    if(line.startsWith('rakho ')) {
      let rest = line.slice(6).trim();
      // allow "x = expr" or "x expr"
      if(rest.includes('=')) {
        const [name, ...rhs] = rest.split('=');
        out += makeAssign(name.trim(), rhs.join('=').trim()) + '\\n';
      } else {
        const parts = rest.split(/\\s+/);
        const name = parts.shift();
        const rhs = parts.join(' ') || '0';
        out += makeAssign(name, rhs) + '\\n';
      }
      continue;
    }

    // += and -=
    if(line.startsWith('badhao ')) {
      const parts = line.slice(7).trim().split(/\\s+/);
      const name = parts.shift();
      const rhs = parts.join(' ') || '1';
      if(!declared.has(name)) declared.add(name); // assume exists (declare earlier would be better)
      out += name + ' += ' + rhs + ';\\n';
      continue;
    }
    if(line.startsWith('ghatao ')) {
      const parts = line.slice(7).trim().split(/\\s+/);
      const name = parts.shift();
      const rhs = parts.join(' ') || '1';
      if(!declared.has(name)) declared.add(name);
      out += name + ' -= ' + rhs + ';\\n';
      continue;
    }

    // while: jabtak cond toh
    if(line.startsWith('jabtak ')) {
      let cond = line.slice(7).trim().replace(/\\btoh\\b/g,'').trim();
      cond = cond || 'true';
      out += 'while(' + cond + ') {' + '\\n';
      continue;
    }

    // if / elif / else
    if(line.startsWith('warna agar ')) {
      let cond = line.slice(10).trim().replace(/\\btoh\\b/g,'').trim();
      out += 'else if(' + cond + ') {' + '\\n';
      continue;
    }
    if(line.startsWith('agar ')) {
      let cond = line.slice(4).trim().replace(/\\btoh\\b/g,'').trim();
      out += 'if(' + cond + ') {' + '\\n';
      continue;
    }
    if(line === 'warna') { out += 'else {' + '\\n'; continue; }
    if(line === 'khatam') { out += '}' + '\\n'; continue; }

    // break / continue
    if(line === 'break' || line === 'continue') { out += line + ';\\n'; continue; }

    // input/int mapping to JS equivalents
    // user can write parseInt(prompt(...)) already; replace int(  with parseInt(
    line = line.replace(/\\bint\\s*\\(/g, 'parseInt(');
    line = line.replace(/\\binput\\s*\\(/g, 'prompt(');
    // boolean words
    line = line.replace(/\\bsach\\b/g, 'true').replace(/\\bgalat\\b/g,'false');

    // default pass-through
    out += line + '\\n';
  }
  return out;
}

/* -------------------------
   Create iframe content and run JS safely
   ------------------------- */
function runJSInIframe(jsCode) {
  // create a unique child id to allow stopping previous
  childWindowId++;
  runningId = childWindowId;
  status.innerText = 'running';

  // build the iframe srcdoc: console -> capture into document body
  const safeSrc = `
  <!doctype html>
  <meta charset="utf-8">
  <style>
    html,body{height:100%;margin:0;background:#000;color:#0f0; font-family:monospace;padding:8px}
    #out{white-space:pre-wrap;font-family:monospace}
    .err{color:#ff6666}
  </style>
  <div id="out"></div>
  <script>
    (function(){
      const out = document.getElementById('out');
      function print(){
        const args = Array.from(arguments).map(a=>{
          try { return (typeof a === 'object' ? JSON.stringify(a) : String(a)); } catch(e){ return String(a); }
        }).join(' ');
        out.innerText += args + "\\n";
      }
      console.log = print;
      console.error = function(){ print('\\n[ERR] ' + Array.from(arguments).join(' ')); };
      try {
        // user code runs here
        ${jsCode}
      } catch(e) {
        const pre = document.createElement('div'); pre.className='err';
        pre.innerText = 'Error: ' + e;
        out.appendChild(pre);
      }
    })();
  <\/script>
  `;
  preview.srcdoc = safeSrc;
  stopBtn.disabled = false;
}

function runHTMLInIframe(htmlCode) {
  childWindowId++;
  runningId = childWindowId;
  status.innerText = 'preview';
  preview.srcdoc = htmlCode;
  stopBtn.disabled = false;
}

/* -------------------------
   Stop/Reset preview
   ------------------------- */
function stopRun() {
  // reset iframe
  preview.srcdoc = '<!doctype html><meta charset="utf-8"><body style="background:#000;color:#0f0;font-family:monospace;padding:8px">Stopped.</body>';
  status.innerText = 'stopped';
  stopBtn.disabled = true;
  runningId = null;
}

/* -------------------------
   Run button handler
   ------------------------- */
runBtn.addEventListener('click', ()=>{
  consoleText.textContent = '';
  const lang = langSel.value;
  const code = editor.value;
  if(lang === 'javascript') {
    // wrap user's code to ensure console.log mapped to preview
    runJSInIframe(code);
  } else if(lang === 'hinglish') {
    try {
      const js = translateHinglishToJS(code);
      runJSInIframe(js);
    } catch(e) {
      alert('Translate Error: ' + e);
    }
  } else if(lang === 'html') {
    // preview HTML/CSS directly
    runHTMLInIframe(code);
  } else {
    // export mode: create a downloadable file depending on extension choice
    const want = prompt('Export mode. Type target language: c, cpp, cs, py, js, html');
    if(!want) return;
    let extension = 'txt';
    if(want.match(/^c(pp)?$/i)) extension = want.toLowerCase().includes('pp') ? 'cpp' : 'c';
    if(want.match(/^cs$/i)) extension = 'cs';
    if(want.match(/^py$/i)) extension = 'py';
    if(want.match(/^js$/i)) extension = 'js';
    if(want.match(/^html?$/i)) extension = 'html';
    downloadString(code, 'code.'+extension);
  }
});

/* stop button */
stopBtn.addEventListener('click', stopRun);

/* -------------------------
   Download helper
   ------------------------- */
function downloadString(text, filename) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:'text/plain'}));
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* ------------- Save/Load/Download UI ------------- */
downloadBtn.addEventListener('click', ()=>{
  const name = filenameInput.value.trim() || 'code.txt';
  downloadString(editor.value, name);
});

/* allow opening saved files from localStorage list */
window.loadFile = loadFile;
window.deleteFile = deleteFile;

/* show files initially */
listFiles();

/* simple keyboard shortcuts */
window.addEventListener('keydown',(e)=>{
  if(e.ctrlKey && e.key === 's') { e.preventDefault(); saveFile(); }
  if(e.ctrlKey && e.key === 'Enter') { e.preventDefault(); runBtn.click(); }
});

/* initial preview */
status.innerText = 'idle';
preview.srcdoc = '<!doctype html><meta charset="utf-8"><body style="background:#000;color:#0f0;font-family:monospace;padding:8px">Welcome to HinglishLang IDE. Choose language and Run.</body>';
</script>
</body>
</html>